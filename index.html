<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anatoly Coin</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --main-gold: #f39c12;
            --dark-bg: #0a0a0a;
            --panel-bg: #1c1c1c;
            --bronze: #cd7f32;
            --silver: #c0c0c0;
            --gold: #ffd700;
        }

        body {
            background-color: var(--dark-bg);
            color: white;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
        }

        #app {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        .screen {
            flex: 1;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .active { display: flex; }

        .score-container {
            text-align: center;
            margin-top: 40px;
            position: relative;
        }

        .currency-label {
            color: #888;
            font-size: 18px;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
        }

        .currency-label:hover {
            color: var(--main-gold);
        }

        .balance-value {
            font-size: 48px;
            font-weight: bold;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .coin-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .main-coin {
            width: 260px;
            height: 260px;
            background: radial-gradient(circle, var(--main-gold), #d35400);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 120px;
            font-weight: bold;
            border: 10px solid #e67e22;
            box-shadow: 0 0 40px rgba(243, 156, 18, 0.4);
            cursor: pointer;
            transition: transform 0.05s;
            touch-action: manipulation;
        }

        .main-coin:active {
            transform: scale(0.92);
        }

        .energy-section {
            width: 100%;
            max-width: 300px;
            margin-bottom: 100px;
        }

        .energy-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .energy-bar {
            width: 100%;
            height: 12px;
            background: #333;
            border-radius: 6px;
            overflow: hidden;
        }

        #energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #f1c40f, #f39c12);
            width: 100%;
            transition: width 0.2s;
        }

        .menu-list {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .menu-item {
            background: var(--panel-bg);
            padding: 15px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .menu-item:active { opacity: 0.8; }
        .item-info h4 { margin: 0; font-size: 16px; }
        .item-info p { margin: 5px 0 0; color: #aaa; font-size: 13px; }
        .price { color: var(--main-gold); font-weight: bold; }

        .nav-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            background: rgba(28, 28, 28, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 12px;
            border-radius: 20px;
            border: 1px solid #333;
        }

        .nav-btn {
            background: none;
            border: none;
            color: #666;
            font-size: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .nav-btn.active-nav { color: white; }

        .tap-number {
            position: absolute;
            color: white;
            font-size: 24px;
            font-weight: bold;
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
            z-index: 100;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-120px); }
        }
        
        .save-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(46, 204, 113, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            z-index: 1000;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 1.7s forwards;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            to { opacity: 0; }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ –¢–æ–ø—ã */
        .leaderboard {
            width: 100%;
            max-width: 400px;
            margin-top: 20px;
        }
        
        .leaderboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .refresh-btn {
            background: var(--main-gold);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            background: var(--panel-bg);
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 8px;
            transition: transform 0.2s;
        }
        
        .leaderboard-item:hover {
            transform: translateX(5px);
        }
        
        .rank {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .rank-1 { background: var(--gold); color: #000; }
        .rank-2 { background: var(--silver); color: #000; }
        .rank-3 { background: var(--bronze); color: #000; }
        .rank-other { background: #333; color: white; }
        
        .player-info {
            flex: 1;
        }
        
        .player-name {
            font-weight: bold;
            font-size: 14px;
        }
        
        .player-score {
            color: var(--main-gold);
            font-weight: bold;
            font-size: 16px;
        }
        
        .player-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .referral-section {
            background: linear-gradient(45deg, #1a2980, #26d0ce);
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            width: 100%;
            max-width: 400px;
        }
        
        .referral-code {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 8px;
            font-family: monospace;
            text-align: center;
            margin: 10px 0;
            cursor: pointer;
            word-break: break-all;
        }
        
        .referral-code:active {
            background: rgba(255,255,255,0.2);
        }
        
        .daily-reward {
            background: linear-gradient(45deg, #f46b45, #eea849);
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .reward-btn {
            background: white;
            color: #f46b45;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
        }
        
        .reward-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .reward-timer {
            font-size: 12px;
            color: rgba(255,255,255,0.8);
            margin-top: 8px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 400px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: var(--panel-bg);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--main-gold);
        }
        
        .stat-label {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ */
        .admin-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--panel-bg);
            border: 2px solid var(--main-gold);
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 400px;
            z-index: 1000;
            box-shadow: 0 0 30px rgba(243, 156, 18, 0.3);
            display: none;
        }
        
        .admin-panel.active {
            display: block;
        }
        
        .admin-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999;
            display: none;
        }
        
        .admin-overlay.active {
            display: block;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .admin-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }
        
        .admin-input-group {
            margin-bottom: 15px;
        }
        
        .admin-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #444;
            background: #2a2a2a;
            color: white;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .admin-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .admin-btn:hover {
            background: linear-gradient(45deg, #229954, #27ae60);
        }
        
        .admin-btns-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .admin-btn-small {
            padding: 10px;
            background: var(--main-gold);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .admin-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e74c3c;
            color: white;
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–¥–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ */
        .code-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--panel-bg);
            border: 2px solid #3498db;
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 350px;
            z-index: 1001;
            box-shadow: 0 0 30px rgba(52, 152, 219, 0.3);
            display: none;
        }
        
        .code-modal.active {
            display: block;
        }
        
        .code-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #3498db;
            background: #2a2a2a;
            color: white;
            font-size: 18px;
            text-align: center;
            letter-spacing: 2px;
            margin: 20px 0;
        }
        
        .code-submit {
            width: 100%;
            padding: 14px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="app">
    <div id="main-screen" class="screen active">
        <div class="score-container">
            <div class="currency-label" onclick="showAdminCodeModal()">–í–ê–õ–Æ–¢–ê –ê–ù–ê–¢–û–õ–ò–ô</div>
            <div class="balance-value" id="balance">0</div>
        </div>

        <div class="coin-wrapper">
            <div class="main-coin" id="coin">–ê</div>
        </div>

        <div class="energy-section">
            <div class="energy-info">
                <span>‚ö° –≠–Ω–µ—Ä–≥–∏—è</span>
                <span id="energy-text">1000 / 1000</span>
            </div>
            <div class="energy-bar">
                <div id="energy-fill"></div>
            </div>
        </div>
    </div>

    <div id="boosts-screen" class="screen">
        <h2>–ú–∞–≥–∞–∑–∏–Ω –ë—É—Å—Ç–æ–≤</h2>
        <div class="menu-list">
            <div class="menu-item" onclick="buyMultitap()">
                <div class="item-info">
                    <h4>Multitap</h4>
                    <p>+1 –∫ –∫–ª–∏–∫—É</p>
                </div>
                <div class="price" id="multitap-price">100</div>
            </div>
            <div class="menu-item" onclick="buyEnergyLimit()">
                <div class="item-info">
                    <h4>Energy Limit</h4>
                    <p>+500 –∫ –º–∞–∫—Å. —ç–Ω–µ—Ä–≥–∏–∏</p>
                </div>
                <div class="price" id="energy-price">500</div>
            </div>
            <div class="menu-item" onclick="buyAutoClicker()">
                <div class="item-info">
                    <h4>Auto Clicker</h4>
                    <p>–ê–≤—Ç–æ-–∫–ª–∏–∫ 1/—Å–µ–∫</p>
                </div>
                <div class="price" id="autoclicker-price">2000</div>
            </div>
        </div>
    </div>

    <div id="tasks-screen" class="screen">
        <h2>–ó–∞–¥–∞–Ω–∏—è</h2>
        <div class="menu-list">
            <div class="menu-item" onclick="completeTask(1000, this, 'https://t.me/podilcliker')">
                <div class="item-info">
                    <h4>–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Podil Cliker</h4>
                    <p>–í—Å—Ç—É–ø–∏ –≤ –≥—Ä—É–ø–ø—É –∏ –ø–æ–ª—É—á–∏ –±–æ–Ω—É—Å</p>
                </div>
                <div class="price">+1000 –ê–Ω–∞—Ç–æ–ª–∏–π</div>
            </div>
            <div class="menu-item" onclick="completeTask(500, this)">
                <div class="item-info">
                    <h4>100 —Ç–∞–ø–æ–≤ –∑–∞ –¥–µ–Ω—å</h4>
                    <p id="taps-progress">–ü—Ä–æ–≥—Ä–µ—Å—Å: 0/100</p>
                </div>
                <div class="price">+500 –ê–Ω–∞—Ç–æ–ª–∏–π</div>
            </div>
            <div class="menu-item" onclick="completeTask(2000, this)">
                <div class="item-info">
                    <h4>–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞</h4>
                    <p>–î—Ä—É–≥ –ø–æ–ª—É—á–∏—Ç –±–æ–Ω—É—Å 1000 –º–æ–Ω–µ—Ç</p>
                </div>
                <div class="price">+2000 –ê–Ω–∞—Ç–æ–ª–∏–π</div>
            </div>
        </div>
    </div>

    <div id="top-screen" class="screen">
        <h2>üèÜ –¢–æ–ø –ò–≥—Ä–æ–∫–æ–≤</h2>
        
        <div class="leaderboard">
            <div class="leaderboard-header">
                <h3 style="margin: 0;">–ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥</h3>
                <button class="refresh-btn" onclick="loadLeaderboard()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            
            <div id="leaderboard-list">
                <!-- –°—é–¥–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —Ç–æ–ø –∏–≥—Ä–æ–∫–æ–≤ -->
            </div>
        </div>
        
        <div class="referral-section">
            <h4 style="margin: 0 0 10px 0;">üë• –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</h4>
            <p style="font-size: 12px; margin: 0 0 10px 0;">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞ –ø–æ —Å—Å—ã–ª–∫–µ –∏ –ø–æ–ª—É—á–∞–π 10% –æ—Ç –µ–≥–æ –¥–æ—Ö–æ–¥–∞!</p>
            <div class="referral-code" onclick="copyReferralCode()" id="referral-code">
                –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>
            <p style="font-size: 11px; color: rgba(255,255,255,0.7); margin: 5px 0 0 0;">
                –ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π: <span id="referral-count">0</span>
            </p>
        </div>
        
        <div class="daily-reward">
            <h4 style="margin: 0 0 10px 0;">üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞</h4>
            <p style="font-size: 14px; margin: 0 0 10px 0;">–ó–∞–π–¥–∏ –∑–∞–≤—Ç—Ä–∞ –∏ –ø–æ–ª—É—á–∏ –±–æ–Ω—É—Å!</p>
            <button class="reward-btn" onclick="claimDailyReward()" id="daily-reward-btn">
                –ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É
            </button>
            <div class="reward-timer" id="reward-timer"></div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="total-taps">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ —Ç–∞–ø–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-boosts">0</div>
                <div class="stat-label">–ö—É–ø–ª–µ–Ω–æ –±—É—Å—Ç–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="session-earned">0</div>
                <div class="stat-label">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞ —Å–µ—Å—Å–∏—é</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="player-rank">#-</div>
                <div class="stat-label">–í–∞—à —Ä–∞–Ω–≥</div>
            </div>
        </div>
    </div>

    <nav class="nav-bar">
        <div class="nav-btn active-nav" onclick="showScreen('main-screen', this)">
            <span>üîò</span><span>–¢–∞–ø</span>
        </div>
        <div class="nav-btn" onclick="showScreen('tasks-screen', this)">
            <span>üìã</span><span>–ó–∞–¥–∞–Ω–∏—è</span>
        </div>
        <div class="nav-btn" onclick="showScreen('boosts-screen', this)">
            <span>üöÄ</span><span>–ë—É—Å—Ç—ã</span>
        </div>
        <div class="nav-btn" onclick="showScreen('top-screen', this)">
            <span>üèÜ</span><span>–¢–æ–ø—ã</span>
        </div>
    </nav>
</div>

<!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω -->
<div class="admin-overlay" id="adminOverlay" onclick="closeAdminPanel()"></div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ –∫–æ–¥–∞ –∞–¥–º–∏–Ω–∞ -->
<div class="code-modal" id="codeModal">
    <h2 style="text-align: center; margin: 0 0 15px 0;">üîê –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</h2>
    <p style="text-align: center; color: #aaa; font-size: 14px; margin-bottom: 10px;">
        –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    </p>
    <input type="text" class="code-input" id="adminCodeInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥..." maxlength="20">
    <button class="code-submit" onclick="checkAdminCode()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
</div>

<!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
<div class="admin-panel" id="adminPanel">
    <div class="admin-header">
        <h2 style="margin: 0;">‚öôÔ∏è –ü–∞–Ω–µ–ª—å –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
        <button class="admin-close" onclick="closeAdminPanel()">√ó</button>
    </div>
    
    <div class="admin-input-group">
        <input type="number" class="admin-input" id="adminCoinsAmount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç">
        <button class="admin-btn" onclick="addAdminCoins()">–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–µ—Ç—ã</button>
    </div>
    
    <div class="admin-btns-grid">
        <button class="admin-btn-small" onclick="addCoins(1000)">+1,000</button>
        <button class="admin-btn-small" onclick="addCoins(10000)">+10,000</button>
        <button class="admin-btn-small" onclick="addCoins(100000)">+100,000</button>
        <button class="admin-btn-small" onclick="addCoins(1000000)">+1,000,000</button>
    </div>
    
    <div style="margin-top: 20px; border-top: 1px solid #444; padding-top: 15px;">
        <button class="admin-btn" onclick="resetEnergy()" style="background: linear-gradient(45deg, #3498db, #2980b9);">
            ‚ôªÔ∏è –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é
        </button>
        <button class="admin-btn" onclick="resetGame()" style="background: linear-gradient(45deg, #e74c3c, #c0392b); margin-top: 10px;">
            üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É
        </button>
    </div>
    
    <div style="margin-top: 15px; font-size: 12px; color: #888; text-align: center;">
        –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: <span id="currentBalanceAdmin">0</span> –º–æ–Ω–µ—Ç
    </div>
</div>

<script>
    let state = {
        balance: 0,
        energy: 1000,
        maxEnergy: 1000,
        clickValue: 1,
        multitapCost: 100,
        energyCost: 500,
        autoclickerCost: 2000,
        autoclickerLevel: 0,
        version: "1.2",
        totalTaps: 0,
        totalEarned: 0,
        sessionStart: Date.now(),
        referrals: [],
        referralCode: null,
        dailyRewardLastClaim: 0,
        dailyRewardStreak: 0,
        isAdmin: false
    };

    const tg = window.Telegram.WebApp;
    tg.expand();
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
    if (!tg.initDataUnsafe.user) {
        tg.initDataUnsafe.user = {
            id: Math.random().toString(36).substring(2) + Date.now().toString(36),
            first_name: "–ò–≥—Ä–æ–∫",
            username: "player"
        };
    }
    
    const user = tg.initDataUnsafe.user;
    const userId = user.id;
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Cloud Storage
    tg.CloudStorage.setInitParams({'count': 1});

    const balanceEl = document.getElementById('balance');
    const energyFill = document.getElementById('energy-fill');
    const energyText = document.getElementById('energy-text');
    const coin = document.getElementById('coin');

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    function loadGameState() {
        tg.CloudStorage.getItems(['game_state', 'leaderboard'], (err, result) => {
            if (!err) {
                if (result && result.game_state) {
                    try {
                        const savedState = JSON.parse(result.game_state);
                        if (savedState.version === state.version) {
                            Object.assign(state, savedState);
                            updateUI();
                            showSaveNotification('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
                        }
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
                    }
                }
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                if (!state.referralCode) {
                    state.referralCode = generateReferralCode();
                    autoSave();
                }
                
                updateReferralUI();
                checkDailyReward();
                loadLeaderboard();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                if (state.isAdmin) {
                    document.querySelector('.currency-label').innerHTML = 
                        '–í–ê–õ–Æ–¢–ê –ê–ù–ê–¢–û–õ–ò–ô <span class="admin-badge">ADMIN</span>';
                }
            }
        });
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ –∫–æ–¥–∞ –∞–¥–º–∏–Ω–∞
    function showAdminCodeModal() {
        document.getElementById('codeModal').classList.add('active');
        document.getElementById('adminOverlay').classList.add('active');
        document.getElementById('adminCodeInput').focus();
    }

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    function checkAdminCode() {
        const codeInput = document.getElementById('adminCodeInput');
        const code = codeInput.value.trim();
        
        if (code === 'carapizzz1399') {
            state.isAdmin = true;
            showAdminPanel();
            showSaveNotification('‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            document.querySelector('.currency-label').innerHTML = 
                '–í–ê–õ–Æ–¢–ê –ê–ù–ê–¢–û–õ–ò–ô <span class="admin-badge">ADMIN</span>';
            
            autoSave();
        } else {
            showSaveNotification('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!');
            codeInput.value = '';
            codeInput.focus();
        }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    function showAdminPanel() {
        closeAdminCodeModal();
        document.getElementById('adminPanel').classList.add('active');
        document.getElementById('adminOverlay').classList.add('active');
        document.getElementById('currentBalanceAdmin').textContent = state.balance.toLocaleString();
    }

    // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∫–æ–¥–æ–º
    function closeAdminCodeModal() {
        document.getElementById('codeModal').classList.remove('active');
        document.getElementById('adminOverlay').classList.remove('active');
    }

    // –ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    function closeAdminPanel() {
        document.getElementById('adminPanel').classList.remove('active');
        document.getElementById('adminOverlay').classList.remove('active');
        document.getElementById('codeModal').classList.remove('active');
    }

    // –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–µ—Ç—ã —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
    function addAdminCoins() {
        if (!state.isAdmin) {
            showSaveNotification('‚ùå –ù–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!');
            return;
        }
        
        const amountInput = document.getElementById('adminCoinsAmount');
        const amount = parseInt(amountInput.value);
        
        if (isNaN(amount) || amount <= 0) {
            showSaveNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ!');
            return;
        }
        
        state.balance += amount;
        state.totalEarned += amount;
        updateUI();
        autoSave();
        
        amountInput.value = '';
        document.getElementById('currentBalanceAdmin').textContent = state.balance.toLocaleString();
        showSaveNotification(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ ${amount.toLocaleString()} –º–æ–Ω–µ—Ç!`);
    }

    // –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–æ–Ω–µ—Ç
    function addCoins(amount) {
        if (!state.isAdmin) {
            showSaveNotification('‚ùå –ù–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!');
            return;
        }
        
        state.balance += amount;
        state.totalEarned += amount;
        updateUI();
        autoSave();
        
        document.getElementById('adminCoinsAmount').value = '';
        document.getElementById('currentBalanceAdmin').textContent = state.balance.toLocaleString();
        showSaveNotification(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ ${amount.toLocaleString()} –º–æ–Ω–µ—Ç!`);
    }

    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é
    function resetEnergy() {
        if (!state.isAdmin) {
            showSaveNotification('‚ùå –ù–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!');
            return;
        }
        
        state.energy = state.maxEnergy;
        updateUI();
        autoSave();
        showSaveNotification('‚úÖ –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!');
    }

    // –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É
    function resetGame() {
        if (!state.isAdmin) {
            showSaveNotification('‚ùå –ù–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!');
            return;
        }
        
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—é –∏–≥—Ä—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
            state = {
                balance: 0,
                energy: 1000,
                maxEnergy: 1000,
                clickValue: 1,
                multitapCost: 100,
                energyCost: 500,
                autoclickerCost: 2000,
                autoclickerLevel: 0,
                version: "1.2",
                totalTaps: 0,
                totalEarned: 0,
                sessionStart: Date.now(),
                referrals: [],
                referralCode: state.referralCode || generateReferralCode(),
                dailyRewardLastClaim: 0,
                dailyRewardStreak: 0,
                isAdmin: true
            };
            
            updateUI();
            autoSave();
            showSaveNotification('üîÑ –ò–≥—Ä–∞ —Å–±—Ä–æ—à–µ–Ω–∞!');
            closeAdminPanel();
        }
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
    function generateReferralCode() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let code = '';
        for (let i = 0; i < 8; i++) {
            code += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return code;
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
    function copyReferralCode() {
        const code = `https://t.me/share/url?url=–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ Anatoly Coin!&text=–ò–≥—Ä–∞–π –≤ Anatoly Coin! –ò—Å–ø–æ–ª—å–∑—É–π –º–æ–π –∫–æ–¥: ${state.referralCode} –¥–ª—è –±–æ–Ω—É—Å–∞!`;
        navigator.clipboard.writeText(code).then(() => {
            showSaveNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
        });
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –Ω–∞–≥—Ä–∞–¥—ã
    function checkDailyReward() {
        const now = Date.now();
        const lastClaim = state.dailyRewardLastClaim;
        const oneDay = 24 * 60 * 60 * 1000;
        
        const btn = document.getElementById('daily-reward-btn');
        const timer = document.getElementById('reward-timer');
        
        if (now - lastClaim < oneDay) {
            // –ù–∞–≥—Ä–∞–¥–∞ —É–∂–µ –ø–æ–ª—É—á–µ–Ω–∞ —Å–µ–≥–æ–¥–Ω—è
            btn.disabled = true;
            btn.textContent = '–£–∂–µ –ø–æ–ª—É—á–µ–Ω–æ';
            
            const nextClaim = lastClaim + oneDay;
            const timeLeft = nextClaim - now;
            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            
            timer.textContent = `–°–ª–µ–¥—É—é—â–∞—è –Ω–∞–≥—Ä–∞–¥–∞ —á–µ—Ä–µ–∑: ${hours}—á ${minutes}–º`;
        } else if (now - lastClaim > oneDay * 2) {
            // –ü—Ä–æ–ø—É—Å—Ç–∏–ª –¥–µ–Ω—å - —Å–±—Ä–æ—Å —Å–µ—Ä–∏–∏
            state.dailyRewardStreak = 0;
        }
        
        btn.textContent = `–ó–∞–±—Ä–∞—Ç—å (${state.dailyRewardStreak + 1} –¥–µ–Ω—å)`;
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –Ω–∞–≥—Ä–∞–¥—ã
    function claimDailyReward() {
        const reward = 1000 * (state.dailyRewardStreak + 1);
        state.balance += reward;
        state.dailyRewardLastClaim = Date.now();
        state.dailyRewardStreak++;
        
        updateUI();
        autoSave();
        checkDailyReward();
        showSaveNotification(`üéÅ –ü–æ–ª—É—á–µ–Ω–æ ${reward.toLocaleString()} –º–æ–Ω–µ—Ç!`);
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
    function loadLeaderboard() {
        tg.CloudStorage.getItems(['leaderboard'], (err, result) => {
            if (!err && result && result.leaderboard) {
                try {
                    const leaderboard = JSON.parse(result.leaderboard);
                    displayLeaderboard(leaderboard);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:', e);
                    // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥ –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö
                    createSampleLeaderboard();
                }
            } else {
                createSampleLeaderboard();
            }
        });
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
    function createSampleLeaderboard() {
        const samplePlayers = [
            { id: 1, name: "–ê–Ω–∞—Ç–æ–ª–∏–π", score: 1500000, avatar: "–ê" },
            { id: 2, name: user.first_name, score: state.totalEarned, avatar: user.first_name[0] },
            { id: 3, name: "–ö–ª–∏–∫–µ—Ä –ü—Ä–æ", score: 850000, avatar: "–ö" },
            { id: 4, name: "–¢–∞–ø –ú–∞—Å—Ç–µ—Ä", score: 720000, avatar: "–¢" },
            { id: 5, name: "–ó–æ–ª–æ—Ç–æ–π –†—É–∫–∞", score: 580000, avatar: "–ó" },
            { id: 6, name: "–ë—É—Å—Ç–µ—Ä", score: 450000, avatar: "–ë" },
            { id: 7, name: "–ù–æ–≤–∏—á–æ–∫", score: 120000, avatar: "–ù" }
        ];
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é –æ—á–∫–æ–≤
        samplePlayers.sort((a, b) => b.score - a.score);
        displayLeaderboard(samplePlayers);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const userRank = samplePlayers.findIndex(p => p.id === 2) + 1;
        document.getElementById('player-rank').textContent = `#${userRank}`;
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
    function displayLeaderboard(players) {
        const leaderboardList = document.getElementById('leaderboard-list');
        leaderboardList.innerHTML = '';
        
        players.slice(0, 10).forEach((player, index) => {
            const rankClass = `rank rank-${index < 3 ? index + 1 : 'other'}`;
            const item = document.createElement('div');
            item.className = 'leaderboard-item';
            item.innerHTML = `
                <div class="${rankClass}">${index + 1}</div>
                <div class="player-info">
                    <div class="player-name">${player.name}</div>
                    <div style="font-size: 11px; color: #888;">${player.id === 2 ? '–í—ã' : ''}</div>
                </div>
                <div class="player-score">${player.score.toLocaleString()}</div>
                <div class="player-avatar">${player.avatar}</div>
            `;
            leaderboardList.appendChild(item);
        });
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
    function updateReferralUI() {
        document.getElementById('referral-code').textContent = `–ö–æ–¥: ${state.referralCode}`;
        document.getElementById('referral-count').textContent = state.referrals.length;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        document.getElementById('total-taps').textContent = state.totalTaps.toLocaleString();
        document.getElementById('total-boosts').textContent = (state.clickValue - 1 + state.autoclickerLevel).toLocaleString();
        document.getElementById('session-earned').textContent = calculateSessionEarned().toLocaleString();
    }

    // –†–∞—Å—á–µ—Ç –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –∑–∞ —Å–µ—Å—Å–∏—é
    function calculateSessionEarned() {
        return Math.floor((Date.now() - state.sessionStart) / 1000) * 10;
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    function saveGameState() {
        const stateString = JSON.stringify(state);
        tg.CloudStorage.setItem('game_state', stateString, (err, result) => {
            if (!err) {
                console.log('–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
            } else {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', err);
                // –†–µ–∑–µ—Ä–≤–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
                try {
                    localStorage.setItem('anatoly_coin_backup', stateString);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
                }
            }
        });
    }

    // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    function autoSave() {
        saveGameState();
        updateReferralUI();
        showSaveNotification('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
    }

    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    function showSaveNotification(text) {
        const existing = document.querySelector('.save-notification');
        if (existing) existing.remove();
        
        const notification = document.createElement('div');
        notification.className = 'save-notification';
        notification.innerHTML = `üíæ ${text}`;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 2000);
    }

    coin.addEventListener('touchstart', (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        handleTap(touch.clientX, touch.clientY);
    });

    function handleTap(x, y) {
        if (state.energy >= state.clickValue) {
            state.balance += state.clickValue;
            state.energy -= state.clickValue;
            state.totalTaps++;
            state.totalEarned += state.clickValue;
            
            updateUI();
            createAnim(x, y);
            tg.HapticFeedback.impactOccurred('medium');
            autoSave();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–¥–∞–Ω–∏—è
            updateTaskProgress();
        }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–¥–∞–Ω–∏—è
    function updateTaskProgress() {
        const progress = document.getElementById('taps-progress');
        if (progress) {
            progress.textContent = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${state.totalTaps % 100}/100`;
        }
    }

    function createAnim(x, y) {
        const el = document.createElement('div');
        el.className = 'tap-number';
        el.innerText = `+${state.clickValue}`;
        el.style.left = `${x}px`;
        el.style.top = `${y}px`;
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 800);
    }

    // –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä
    function buyAutoClicker() {
        if (state.balance >= state.autoclickerCost) {
            state.balance -= state.autoclickerCost;
            state.autoclickerLevel++;
            state.autoclickerCost *= 2;
            document.getElementById('autoclicker-price').innerText = state.autoclickerCost;
            updateUI();
            tg.HapticFeedback.notificationOccurred('success');
            autoSave();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –µ—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π —É—Ä–æ–≤–µ–Ω—å
            if (state.autoclickerLevel === 1) {
                startAutoClicker();
            }
        }
    }

    // –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞
    function startAutoClicker() {
        setInterval(() => {
            if (state.energy >= state.clickValue) {
                state.balance += state.clickValue;
                state.energy -= state.clickValue;
                state.totalEarned += state.clickValue;
                updateUI();
            }
        }, 1000);
    }

    function buyMultitap() {
        if (state.balance >= state.multitapCost) {
            state.balance -= state.multitapCost;
            state.clickValue += 1;
            state.multitapCost *= 2;
            document.getElementById('multitap-price').innerText = state.multitapCost;
            updateUI();
            tg.HapticFeedback.notificationOccurred('success');
            autoSave();
        }
    }

    function buyEnergyLimit() {
        if (state.balance >= state.energyCost) {
            state.balance -= state.energyCost;
            state.maxEnergy += 500;
            state.energy += 500;
            state.energyCost *= 2;
            document.getElementById('energy-price').innerText = state.energyCost;
            updateUI();
            tg.HapticFeedback.notificationOccurred('success');
            autoSave();
        }
    }

    function completeTask(reward, el, url) {
        state.balance += reward;
        state.totalEarned += reward;
        updateUI();
        
        if (el) {
            el.style.display = 'none';
        }
        
        if (url) {
            tg.openTelegramLink(url);
        }
        
        tg.HapticFeedback.notificationOccurred('success');
        autoSave();
        showSaveNotification(`+${reward.toLocaleString()} –º–æ–Ω–µ—Ç!`);
    }

    function updateUI() {
        balanceEl.innerText = state.balance.toLocaleString();
        const energyPerc = (state.energy / state.maxEnergy) * 100;
        energyFill.style.width = `${energyPerc}%`;
        energyText.innerText = `${Math.floor(state.energy)} / ${state.maxEnergy}`;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        updateReferralUI();
    }

    // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    setInterval(() => {
        autoSave();
    }, 30000);

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏/—Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–∏
    tg.onEvent('viewportChanged', () => {
        autoSave();
    });

    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
    setInterval(() => {
        if (state.energy < state.maxEnergy) {
            state.energy = Math.min(state.energy + 1.5, state.maxEnergy);
            updateUI();
        }
    }, 1000);

    function showScreen(screenId, btn) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-nav'));
        btn.classList.add('active-nav');
        
        // –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —ç–∫—Ä–∞–Ω–∞ —Ç–æ–ø–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥
        if (screenId === 'top-screen') {
            loadLeaderboard();
        }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∫–æ–¥–∞
    document.getElementById('adminCodeInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            checkAdminCode();
        }
    });

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    loadGameState();
    updateUI();
</script>
</body>
</html>